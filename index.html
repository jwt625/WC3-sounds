<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WC3 Sound Browser</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Trebuchet MS', 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #ffd700;
            text-shadow: 0 0 20px #ffd700, 0 0 30px #ff8800;
            font-size: 2.5em;
            letter-spacing: 2px;
        }

        .subtitle {
            text-align: center;
            margin-bottom: 30px;
            color: #87ceeb;
            font-style: italic;
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-group {
            flex: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #87ceeb;
            font-weight: bold;
        }

        select, button, input {
            width: 100%;
            padding: 10px;
            background: #0f3460;
            color: #e0e0e0;
            border: 2px solid #16a085;
            font-family: 'Trebuchet MS', sans-serif;
            font-size: 14px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
        }

        select:hover, button:hover {
            background: linear-gradient(135deg, #1abc9c 0%, #2ecc71 100%);
            border-color: #ffd700;
            transform: translateY(-2px);
            color: #fff;
        }

        button {
            background: linear-gradient(135deg, #16a085 0%, #1abc9c 100%);
            margin-top: 5px;
            font-weight: bold;
            transition: all 0.2s ease;
        }

        button:active {
            transform: translateY(0);
            background: linear-gradient(135deg, #148f77 0%, #16a085 100%);
        }

        .info-panel {
            background: linear-gradient(135deg, #0f3460 0%, #1a1a2e 100%);
            border: 2px solid #16a085;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .info-panel h2 {
            color: #ffd700;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #ffd700;
        }

        .info-row {
            margin: 5px 0;
        }

        .info-label {
            color: #87ceeb;
            display: inline-block;
            width: 120px;
            font-weight: bold;
        }

        .sound-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .action-card {
            background: linear-gradient(135deg, #0f3460 0%, #1a1a2e 100%);
            border: 2px solid #16a085;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }

        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(22, 160, 133, 0.4);
        }

        .action-card h3 {
            color: #ffd700;
            margin-bottom: 10px;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .sound-item {
            padding: 8px;
            margin: 5px 0;
            background: #1a1a2e;
            border: 1px solid #0f3460;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            transition: all 0.2s;
        }

        .sound-item:hover {
            background: #1e4a6e;
            border-color: #1abc9c;
            transform: translateX(5px);
        }

        .sound-item.playing {
            background: #0f3460;
            border-color: #1abc9c;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                border-color: #1abc9c;
                box-shadow: 0 0 6px rgba(26, 188, 156, 0.4);
            }
            50% {
                border-color: #16a085;
                box-shadow: 0 0 12px rgba(26, 188, 156, 0.6);
            }
        }

        .sound-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .sound-name {
            font-size: 12px;
            flex: 1;
        }

        .play-btn {
            background: linear-gradient(135deg, #16a085 0%, #1abc9c 100%);
            border: 1px solid #ffd700;
            color: #fff;
            padding: 5px 15px;
            cursor: pointer;
            font-family: 'Trebuchet MS', sans-serif;
            margin-left: 10px;
            font-size: 12px;
            border-radius: 3px;
            font-weight: bold;
            transition: all 0.2s ease;
        }

        .play-btn:hover {
            background: linear-gradient(135deg, #1abc9c 0%, #2ecc71 100%);
            border-color: #ffd700;
            color: #fff;
            box-shadow: 0 0 8px rgba(26, 188, 156, 0.5);
        }

        .play-btn:active {
            background: linear-gradient(135deg, #148f77 0%, #16a085 100%);
            transform: scale(0.95);
            box-shadow: none;
        }

        .transcription {
            font-size: 11px;
            color: #9b9b9b;
            font-style: italic;
            margin-top: 5px;
            padding-left: 5px;
            border-left: 2px solid #16a085;
        }

        .status {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            background: linear-gradient(135deg, #0f3460 0%, #1a1a2e 100%);
            border: 2px solid #16a085;
            border-radius: 5px;
        }

        .error {
            border-color: #e74c3c;
            color: #e74c3c;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat-box {
            background: linear-gradient(135deg, #0f3460 0%, #1a1a2e 100%);
            border: 2px solid #16a085;
            padding: 15px;
            flex: 1;
            min-width: 150px;
            text-align: center;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }

        .stat-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 12px rgba(22, 160, 133, 0.4);
        }

        .stat-value {
            color: #ffd700;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 0 0 10px #ffd700;
        }

        .stat-label {
            color: #87ceeb;
            font-size: 12px;
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .search-box {
            margin-bottom: 20px;
        }

        input[type="text"] {
            width: 100%;
        }

        .hidden {
            display: none;
        }

        /* Race color themes */
        .human { border-color: #4a90e2; }
        .orc { border-color: #c0392b; }
        .night_elf, .nightelf { border-color: #9b59b6; }
        .undead { border-color: #2ecc71; }
        .naga { border-color: #00ced1; }
        .demon { border-color: #ff4500; }
        .creeps { border-color: #8b4513; }
        .critters { border-color: #90ee90; }
        .interface { border-color: #ffd700; }
        .miscellaneous { border-color: #778899; }
        .other { border-color: #daa520; }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚öîÔ∏è WARCRAFT III SOUND BROWSER ‚öîÔ∏è</h1>

        <div class="stats">
            <div class="stat-box">
                <div class="stat-value" id="totalSounds">-</div>
                <div class="stat-label">Total Sounds</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="totalUnits">-</div>
                <div class="stat-label">Units</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="currentlyPlaying">-</div>
                <div class="stat-label">Now Playing</div>
            </div>
        </div>

        <div class="search-box">
            <label for="search">Search Sounds:</label>
            <input type="text" id="search" placeholder="Search by race, unit name, action, or filename...">
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="category">Race / Category:</label>
                <select id="category">
                    <option value="">-- Select Race / Category --</option>
                </select>
            </div>

            <div class="control-group">
                <label for="unit">Unit:</label>
                <select id="unit" disabled>
                    <option value="">-- Select Unit --</option>
                </select>
            </div>

            <div class="control-group">
                <button id="playAllBtn" disabled>Play All Sounds (Sequential)</button>
            </div>
        </div>

        <div class="info-panel" id="unitInfo" style="display: none;">
            <h2>Unit Information</h2>
            <div class="info-row"><span class="info-label">Name:</span><span id="unitName"></span></div>
            <div class="info-row"><span class="info-label">Description:</span><span id="unitDesc"></span></div>
        </div>

        <div class="status" id="status">
            Loading configuration...
        </div>

        <div class="sound-grid" id="soundGrid">
            <!-- Sound cards will be populated here -->
        </div>
    </div>

    <audio id="audioPlayer"></audio>

    <script>
        let config = null;
        let transcriptions = null;
        let additionalTranscriptions = null;
        let currentlyPlayingElement = null;
        let allSoundsQueue = [];
        let isPlayingAll = false;

        const audioPlayer = document.getElementById('audioPlayer');

        // Load config and both transcription files
        Promise.all([
            fetch('wc3_sound_config.json').then(r => r.json()),
            fetch('wc3_transcriptions.json').then(r => r.json()).catch(() => null),
            fetch('wc3_additional_transcriptions.json').then(r => r.json()).catch(() => null)
        ])
            .then(([configData, transcriptData, additionalTranscriptData]) => {
                config = configData;
                transcriptions = transcriptData;
                additionalTranscriptions = additionalTranscriptData;
                if (!transcriptions) {
                    console.warn('Main transcriptions not found, will display without transcripts');
                }
                if (!additionalTranscriptions) {
                    console.warn('Additional transcriptions not found');
                }
                initializeApp();
            })
            .catch(error => {
                document.getElementById('status').textContent = 'Error: ' + error.message;
                document.getElementById('status').classList.add('error');
            });

        function initializeApp() {
            populateCategories();
            updateStats();

            document.getElementById('category').addEventListener('change', onCategoryChange);
            document.getElementById('unit').addEventListener('change', onUnitChange);
            document.getElementById('search').addEventListener('input', onSearch);
            document.getElementById('playAllBtn').addEventListener('click', playAllSounds);

            audioPlayer.addEventListener('ended', onAudioEnded);

            document.getElementById('status').textContent = 'Ready! Select a race/category or use search to explore sounds.';
        }

        function populateCategories() {
            const categorySelect = document.getElementById('category');
            const categories = Object.keys(config).sort();

            const categoryNames = {
                'human': 'üõ°Ô∏è Human Alliance',
                'orc': '‚öîÔ∏è Orcish Horde',
                'nightelf': 'üåô Night Elf Sentinels',
                'night_elf': 'üåô Night Elf Sentinels',
                'undead': 'üíÄ Undead Scourge',
                'creeps': 'üêâ Neutral Creeps',
                'critters': 'üêøÔ∏è Critters',
                'demon': 'üëπ Burning Legion',
                'naga': 'üêç Naga',
                'other': 'üì¶ Other Units',
                'interface': 'üéÆ Interface Sounds',
                'miscellaneous': 'üîä Miscellaneous',
                // Additional sounds from war3_mpq_additional
                'additional_ambient': 'üå≤ Ambient Sounds',
                'additional_dialogue': 'üí¨ Campaign Dialogue',
                'additional_time': '‚è∞ Time of Day',
                'additional_units': 'üéñÔ∏è Additional Units',
                // Abilities from war3_abilities_batch2
                'spells': '‚ú® Spells & Abilities',
                'weapons': 'üèπ Weapon Sounds'
            };

            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = categoryNames[cat] || cat.charAt(0).toUpperCase() + cat.slice(1).replace('_', ' ');
                categorySelect.appendChild(option);
            });
        }

        function updateStats() {
            let totalSounds = 0;
            let totalUnits = 0;

            Object.keys(config).forEach(category => {
                Object.keys(config[category]).forEach(unit => {
                    totalUnits++;
                    const sounds = config[category][unit].sounds || {};
                    Object.values(sounds).forEach(soundList => {
                        totalSounds += soundList.length;
                    });
                });
            });

            document.getElementById('totalSounds').textContent = totalSounds;
            document.getElementById('totalUnits').textContent = totalUnits;
            document.getElementById('currentlyPlaying').textContent = '-';
        }

        function onCategoryChange(e) {
            const category = e.target.value;
            const unitSelect = document.getElementById('unit');

            unitSelect.innerHTML = '<option value="">-- Select Unit --</option>';
            document.getElementById('unitInfo').style.display = 'none';
            document.getElementById('soundGrid').innerHTML = '';
            document.getElementById('playAllBtn').disabled = true;

            if (!category) {
                unitSelect.disabled = true;
                return;
            }

            const units = Object.keys(config[category]).sort((a, b) => {
                const nameA = (config[category][a].name || a).toLowerCase();
                const nameB = (config[category][b].name || b).toLowerCase();
                return nameA.localeCompare(nameB);
            });

            units.forEach(unit => {
                const option = document.createElement('option');
                option.value = unit;
                option.textContent = config[category][unit].name || unit.toUpperCase();
                unitSelect.appendChild(option);
            });

            unitSelect.disabled = false;
            document.getElementById('status').textContent = `${units.length} units available in ${category}`;
        }

        function onUnitChange(e) {
            const category = document.getElementById('category').value;
            const unit = e.target.value;

            if (!unit) {
                document.getElementById('unitInfo').style.display = 'none';
                document.getElementById('soundGrid').innerHTML = '';
                document.getElementById('playAllBtn').disabled = true;
                return;
            }

            const unitData = config[category][unit];
            displayUnitInfo(unitData);
            displaySounds(category, unit, unitData);
            document.getElementById('playAllBtn').disabled = false;
        }

        function displayUnitInfo(unitData) {
            document.getElementById('unitName').textContent = unitData.name || 'N/A';
            document.getElementById('unitDesc').textContent = unitData.description || 'No description';
            document.getElementById('unitInfo').style.display = 'block';
        }

        function displaySounds(category, unit, unitData) {
            const soundGrid = document.getElementById('soundGrid');
            soundGrid.innerHTML = '';

            const sounds = unitData.sounds || {};
            let totalSoundCount = 0;

            Object.keys(sounds).sort().forEach(action => {
                const soundList = sounds[action];
                totalSoundCount += soundList.length;

                const actionCard = document.createElement('div');
                actionCard.className = `action-card ${category}`;

                const actionTitle = document.createElement('h3');
                actionTitle.textContent = `${action.toUpperCase()} (${soundList.length})`;
                actionCard.appendChild(actionTitle);

                // Sort sounds alphabetically by filename
                const sortedSoundList = [...soundList].sort((a, b) => {
                    const nameA = a.split('/').pop().toLowerCase();
                    const nameB = b.split('/').pop().toLowerCase();
                    return nameA.localeCompare(nameB);
                });

                sortedSoundList.forEach(soundFile => {
                    const soundItem = createSoundItemElement(category, unit, action, soundFile);
                    actionCard.appendChild(soundItem);
                });

                soundGrid.appendChild(actionCard);
            });

            document.getElementById('status').textContent =
                `Loaded ${totalSoundCount} sounds across ${Object.keys(sounds).length} actions`;
        }

        function createSoundItemElement(category, unit, action, soundFile) {
            const soundItem = document.createElement('div');
            soundItem.className = 'sound-item';
            soundItem.dataset.category = category;
            soundItem.dataset.unit = unit;
            soundItem.dataset.action = action;
            soundItem.dataset.soundFile = soundFile;

            const header = document.createElement('div');
            header.className = 'sound-item-header';

            const soundName = document.createElement('span');
            soundName.className = 'sound-name';
            const filename = soundFile.split('/').pop();
            soundName.textContent = `${filename}.mp3`;

            const playBtn = document.createElement('button');
            playBtn.className = 'play-btn';
            playBtn.textContent = '‚ñ∂ PLAY';
            playBtn.onclick = (e) => {
                e.stopPropagation();
                playSound(soundFile, soundItem);
            };

            header.appendChild(soundName);
            header.appendChild(playBtn);
            soundItem.appendChild(header);

            // Add transcription if available
            const transcript = getTranscription(soundFile);
            if (transcript) {
                const transcriptionDiv = document.createElement('div');
                transcriptionDiv.className = 'transcription';
                transcriptionDiv.textContent = `"${transcript}"`;
                soundItem.appendChild(transcriptionDiv);
            }

            soundItem.onclick = () => playSound(soundFile, soundItem);

            return soundItem;
        }

        function playSound(soundFile, element) {
            // Handle main sounds, additional sounds, and abilities
            let soundPath;
            if (soundFile.startsWith('war3_mpq_additional/') || soundFile.startsWith('war3_abilities_batch2/')) {
                soundPath = `${soundFile}.mp3`;
            } else {
                soundPath = `sounds/${soundFile}.mp3`;
            }

            if (currentlyPlayingElement) {
                currentlyPlayingElement.classList.remove('playing');
            }

            element.classList.add('playing');
            currentlyPlayingElement = element;

            audioPlayer.src = soundPath;
            audioPlayer.play().catch(error => {
                console.error('Error playing sound:', error);
                document.getElementById('status').textContent = `Error playing: ${soundFile}`;
                document.getElementById('status').classList.add('error');
                element.classList.remove('playing');
            });

            const filename = soundFile.split('/').pop();
            document.getElementById('currentlyPlaying').textContent = filename;
        }

        function onAudioEnded() {
            if (currentlyPlayingElement) {
                currentlyPlayingElement.classList.remove('playing');
                currentlyPlayingElement = null;
            }

            if (isPlayingAll && allSoundsQueue.length > 0) {
                const next = allSoundsQueue.shift();
                playSound(next.soundFile, next.element);
            } else {
                isPlayingAll = false;
                document.getElementById('currentlyPlaying').textContent = '-';
                document.getElementById('playAllBtn').textContent = 'Play All Sounds (Sequential)';
                document.getElementById('playAllBtn').disabled = false;
            }
        }

        function playAllSounds() {
            const soundItems = document.querySelectorAll('.sound-item');
            allSoundsQueue = Array.from(soundItems).map(item => ({
                soundFile: item.dataset.soundFile,
                element: item
            }));

            if (allSoundsQueue.length === 0) return;

            isPlayingAll = true;
            document.getElementById('playAllBtn').textContent = 'Playing...';
            document.getElementById('playAllBtn').disabled = true;

            const first = allSoundsQueue.shift();
            playSound(first.soundFile, first.element);
        }

        function getTranscription(soundFile) {
            // Check main transcriptions first
            if (transcriptions) {
                // Sound file is like "Human/Footman/FootmanYes3" - convert to path
                const path = soundFile + '.mp3';
                if (transcriptions[path]) {
                    return transcriptions[path].transcription;
                }
            }

            // Check additional transcriptions for war3_mpq_additional sounds
            if (additionalTranscriptions && soundFile.startsWith('war3_mpq_additional/')) {
                // Additional transcriptions use path relative to war3_mpq_additional
                const relativePath = soundFile.replace('war3_mpq_additional/', '') + '.mp3';
                if (additionalTranscriptions[relativePath]) {
                    return additionalTranscriptions[relativePath].transcription;
                }
            }

            return null;
        }

        function onSearch(e) {
            const searchTerm = e.target.value.toLowerCase();

            if (searchTerm.length < 2) {
                document.getElementById('soundGrid').innerHTML = '';
                document.getElementById('status').textContent = 'Enter at least 2 characters to search';
                return;
            }

            const results = [];

            Object.keys(config).forEach(category => {
                Object.keys(config[category]).forEach(unit => {
                    const unitData = config[category][unit];
                    const unitName = (unitData.name || '').toLowerCase();
                    const unitDesc = (unitData.description || '').toLowerCase();

                    if (unitName.includes(searchTerm) || unitDesc.includes(searchTerm) ||
                        unit.includes(searchTerm) || category.includes(searchTerm)) {
                        const sounds = unitData.sounds || {};
                        Object.keys(sounds).forEach(action => {
                            sounds[action].forEach(soundFile => {
                                results.push({ category, unit, unitData, action, soundFile, matchType: 'unit' });
                            });
                        });
                    } else {
                        const sounds = unitData.sounds || {};
                        Object.keys(sounds).forEach(action => {
                            if (action.includes(searchTerm)) {
                                sounds[action].forEach(soundFile => {
                                    results.push({ category, unit, unitData, action, soundFile, matchType: 'action' });
                                });
                            } else {
                                sounds[action].forEach(soundFile => {
                                    const transcript = getTranscription(soundFile);
                                    const transcriptMatch = transcript && transcript.toLowerCase().includes(searchTerm);

                                    if (soundFile.toLowerCase().includes(searchTerm) || transcriptMatch) {
                                        results.push({
                                            category,
                                            unit,
                                            unitData,
                                            action,
                                            soundFile,
                                            matchType: transcriptMatch ? 'transcript' : 'file'
                                        });
                                    }
                                });
                            }
                        });
                    }
                });
            });

            displaySearchResults(results, searchTerm);
        }

        function displaySearchResults(results, searchTerm) {
            const soundGrid = document.getElementById('soundGrid');
            soundGrid.innerHTML = '';

            if (results.length === 0) {
                document.getElementById('status').textContent = `No results found for "${searchTerm}"`;
                return;
            }

            document.getElementById('status').textContent = `Found ${results.length} matches for "${searchTerm}"`;

            // Group by unit
            const grouped = {};
            results.forEach(result => {
                const key = `${result.category}:${result.unit}`;
                if (!grouped[key]) {
                    grouped[key] = {
                        category: result.category,
                        unit: result.unit,
                        unitData: result.unitData,
                        sounds: []
                    };
                }
                grouped[key].sounds.push({ action: result.action, soundFile: result.soundFile });
            });

            Object.values(grouped).forEach(group => {
                const actionCard = document.createElement('div');
                actionCard.className = `action-card ${group.category}`;

                const title = document.createElement('h3');
                title.textContent = `${group.unitData.name || group.unit.toUpperCase()} - ${group.category}`;
                actionCard.appendChild(title);

                group.sounds.forEach(({ action, soundFile }) => {
                    const soundItem = createSoundItemElement(group.category, group.unit, action, soundFile);
                    actionCard.appendChild(soundItem);
                });

                soundGrid.appendChild(actionCard);
            });
        }
    </script>
    <footer style="text-align: center; padding: 30px 20px; margin-top: 40px; border-top: 1px solid #333; color: #888; font-size: 14px;">
        <a href="https://github.com/jwt625/WC3-sounds" target="_blank" style="color: #3498db; text-decoration: none;">
            üìÇ View on GitHub
        </a>
    </footer>
</body>
</html>
